<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="nvd3-import.html">

<script>
  var NVD3 = NVD3 || {};

  /**
  NVD3.ChartBehavior provides properties to create nvd3-elements charts.

  @demo demo/index.html
  @group NVD3 Elements
  @element nvd3-behavior
  */

  /**
   * A behavior for nvd3-elements to draw charts.
   */

  NVD3.ChartBehavior = {
    properties: {
      /**
       * NVD3 chart object.
       */
      chart: {
        type: Object
      },

      /*
       * Data
       */
      data: {
        type: Array
      },

      /*
       * SVG object for d3
       */
      svg: {
        type: Object
      },

      /**
       * Stop auto drawing the chart on attaching the element.
       */
      stopAutoDrawing: {
        type: Boolean,
        value: false
      },

      /**
       * Show labels.
       */
      showLabels: {
        type: Boolean,
        value: false
      },

      /**
       * Colors to use for the different data.
       * If an array is given, it is converted to a function automatically.
       */
      color: {
        type: Array,
        value: function() {
          nv.utils.defaultColor();
        }
      },

      /**
       * List of numbers to Force into the X scale (ie. 0, or a max / min, etc.).
       * This ensures the numbers are in the X domain but doesn't override the whole domain.
       * This option only applies if you have not overridden the whole domain with the xDomain option.
       */
      forceX: {
        type: Array,
        value: []
      },

      /**
       * The height the graph or component created inside the SVG should be made.
       * Default: The height of the container element (normally the svg itself).
       */
      height: {
        type: Number
      },

      /**
       * Object containing the margins for the chart or component.
       * You can specify only certain margins in the object to change just those parts.
       */
      margin: {
        type: Object,
        value: {
          "left": 0,
          "right": 0,
          "top": 0,
          "bottom": 0
        }
      },

      /**
       * Message to display if no data is provided.
       */
      noData: {
        type: String,
        value: 'No Data Available.'
      },

      /**
       * The width the graph or component created inside the SVG should be made.
       * Default: The width of the container element (normally the svg itself).
       */
      width: {
        type: Number
      }
    },

    /**
     * Set nvd3 chart configs based on Element properties.
     */
    _setConfigs: function() {
      /**
      * Check if the chart has showLables function.
      */
      if (typeof this.chart.showLabels !== 'undefined') {
        this.chart.showLabels(this.showLabels);
      }

      this.chart.color(this.color);
      this.chart.forceX(this.forceX);
      this.chart.margin(this.margin);
      this.chart.noData(this.noData);

      if (typeof this.height === 'number' && this.height > 0) {
        this.chart.height(this.height);
      }

      if (typeof this.width === 'number' && this.width > 0) {
        this.chart.width(this.width);
      }
    },

    /**
     * Generate and attach the chart;
     */
    generateChart: function() {
      this._setConfigs();

      var chart = this.chart;
      var data = this.data;
      var svg = this.svg;

      nv.addGraph(function() {
        d3.select(svg)
          .datum(data)
          .call(chart);

        return chart;
      });
    }
  };
</script>
